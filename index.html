<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>محلل موجات Elliott Wave</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            direction: rtl;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .controls {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .control-group {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .control-item {
            flex: 1;
            min-width: 200px;
        }
        
        .control-item label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }
        
        .control-item select, .control-item input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .control-item select:focus, .control-item input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 150px;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #ddd;
        }
        
        .btn-secondary:hover {
            background: #e9ecef;
        }
        
        .results {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .analysis-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }
        
        .symbol-info h2 {
            color: #333;
            margin-bottom: 5px;
        }
        
        .symbol-info .price {
            font-size: 1.5rem;
            font-weight: bold;
            color: #28a745;
        }
        
        .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 12px;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .patterns-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .pattern-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border-left: 5px solid #667eea;
        }
        
        .pattern-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .pattern-type {
            font-weight: bold;
            color: #333;
            font-size: 1.1rem;
        }
        
        .confidence {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .confidence.high {
            background: #28a745;
        }
        
        .confidence.medium {
            background: #ffc107;
            color: #333;
        }
        
        .confidence.low {
            background: #dc3545;
        }
        
        .pattern-direction {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .direction-arrow {
            font-size: 1.5rem;
        }
        
        .direction-up {
            color: #28a745;
        }
        
        .direction-down {
            color: #dc3545;
        }
        
        .summary-box {
            background: #e7f3ff;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-right: 5px solid #007bff;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #f5c6cb;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .control-group {
                flex-direction: column;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                min-width: auto;
            }
        }
    </style>
    <script src="webAPI.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🌊 محلل موجات Elliott Wave</h1>
            <p>تحليل متقدم للأسواق المالية باستخدام نظرية Elliott Wave</p>
        </div>

        <div class="controls">
            <div class="control-group">
                <div class="control-item">
                    <label for="symbolSelect">الرمز المالي:</label>
                    <select id="symbolSelect">
                        <option value="BTCUSDT">Bitcoin (BTC/USDT)</option>
                        <option value="ETHUSDT">Ethereum (ETH/USDT)</option>
                        <option value="ADAUSDT">Cardano (ADA/USDT)</option>
                        <option value="BNBUSDT">Binance Coin (BNB/USDT)</option>
                        <option value="XRPUSDT">Ripple (XRP/USDT)</option>
                        <option value="SOLUSDT">Solana (SOL/USDT)</option>
                        <option value="DOTUSDT">Polkadot (DOT/USDT)</option>
                        <option value="LINKUSDT">Chainlink (LINK/USDT)</option>
                    </select>
                </div>
                
                <div class="control-item">
                    <label for="intervalSelect">الفترة الزمنية:</label>
                    <select id="intervalSelect">
                        <option value="15m">15 دقيقة</option>
                        <option value="30m">30 دقيقة</option>
                        <option value="1h" selected>ساعة واحدة</option>
                        <option value="4h">4 ساعات</option>
                        <option value="1d">يوم واحد</option>
                        <option value="1w">أسبوع واحد</option>
                    </select>
                </div>
                
                <div class="control-item">
                    <label for="limitInput">عدد الشموع:</label>
                    <input type="number" id="limitInput" value="100" min="50" max="500">
                </div>
            </div>

            <div class="button-group">
                <button class="btn-primary" onclick="analyzeSymbol()">
                    🔍 تحليل الرمز
                </button>
                <button class="btn-secondary" onclick="startContinuousAnalysis()">
                    🔄 تحليل مستمر
                </button>
                <button class="btn-secondary" onclick="stopContinuousAnalysis()">
                    ⏹️ إيقاف التحليل
                </button>
                <button class="btn-secondary" onclick="clearResults()">
                    🗑️ مسح النتائج
                </button>
            </div>
        </div>

        <div id="results" class="results" style="display: none;">
            <!-- النتائج ستظهر هنا -->
        </div>
    </div>

    <script>
        let continuousAnalysisInterval = null;
        let isAnalyzing = false;

        // دالة تحليل الرمز
        async function analyzeSymbol() {
            if (isAnalyzing) {
                showError('التحليل قيد التشغيل بالفعل...');
                return;
            }

            const symbol = document.getElementById('symbolSelect').value;
            const interval = document.getElementById('intervalSelect').value;
            const limit = document.getElementById('limitInput').value;

            showLoading('جاري تحليل ' + symbol + '...');
            isAnalyzing = true;

            try {
                // محاكاة استدعاء API
                const analysis = await simulateAnalysis(symbol, interval, limit);
                displayResults(analysis);
            } catch (error) {
                showError('خطأ في التحليل: ' + error.message);
            } finally {
                isAnalyzing = false;
            }
        }

        // دالة بدء التحليل المستمر
        function startContinuousAnalysis() {
            if (continuousAnalysisInterval) {
                showError('التحليل المستمر يعمل بالفعل');
                return;
            }

            analyzeSymbol();
            continuousAnalysisInterval = setInterval(() => {
                if (!isAnalyzing) {
                    analyzeSymbol();
                }
            }, 60000); // كل دقيقة

            showInfo('تم بدء التحليل المستمر - سيتم التحليل كل دقيقة');
        }

        // دالة إيقاف التحليل المستمر
        function stopContinuousAnalysis() {
            if (continuousAnalysisInterval) {
                clearInterval(continuousAnalysisInterval);
                continuousAnalysisInterval = null;
                showInfo('تم إيقاف التحليل المستمر');
            } else {
                showError('التحليل المستمر غير نشط');
            }
        }

        // دالة مسح النتائج
        function clearResults() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.style.display = 'none';
            resultsDiv.innerHTML = '';
        }

        // دالة عرض حالة التحميل
        function showLoading(message) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>${message}</p>
                </div>
            `;
            resultsDiv.style.display = 'block';
        }

        // دالة عرض النتائج
        function displayResults(analysis) {
            const resultsDiv = document.getElementById('results');
            
            if (analysis.status === 'success') {
                resultsDiv.innerHTML = `
                    <div class="analysis-header">
                        <div class="symbol-info">
                            <h2>${analysis.symbol}</h2>
                            <div class="price">$${analysis.currentPrice.toFixed(4)}</div>
                        </div>
                        <div class="status-badge status-success">نجح التحليل</div>
                    </div>

                    <div class="patterns-grid">
                        ${analysis.patterns.map(pattern => `
                            <div class="pattern-card">
                                <div class="pattern-header">
                                    <div class="pattern-type">${pattern.type}</div>
                                    <div class="confidence ${getConfidenceClass(pattern.confidence)}">
                                        ${pattern.confidence.toFixed(1)}%
                                    </div>
                                </div>
                                <div class="pattern-direction">
                                                                      <span class="direction-arrow ${pattern.direction === 'صاعد' ? 'direction-up' : 'direction-down'}">
                                        ${pattern.direction === 'صاعد' ? '📈' : '📉'}
                                    </span>
                                    <span>${pattern.direction}</span>
                                </div>
                                <div class="pattern-details">
                                    <p><strong>نقطة البداية:</strong> ${pattern.startIndex}</p>
                                    <p><strong>نقطة النهاية:</strong> ${pattern.endIndex}</p>
                                    <p><strong>طول الموجة:</strong> ${pattern.waveLength.toFixed(2)}%</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="summary-box">
                        <h3>📝 ملخص التحليل</h3>
                        <p>${analysis.summary}</p>
                        <p><strong>عدد الأنماط المكتشفة:</strong> ${analysis.patterns.length}</p>
                        <p><strong>وقت التحليل:</strong> ${new Date().toLocaleString('ar-SA')}</p>
                    </div>
                `;
            } else {
                resultsDiv.innerHTML = `
                    <div class="analysis-header">
                        <div class="symbol-info">
                            <h2>${analysis.symbol || 'غير محدد'}</h2>
                        </div>
                        <div class="status-badge status-error">فشل التحليل</div>
                    </div>
                    <div class="error-message">
                        <h3>❌ خطأ في التحليل</h3>
                        <p>${analysis.message}</p>
                    </div>
                `;
            }
            
            resultsDiv.style.display = 'block';
        }

        // دالة تحديد فئة مستوى الثقة
        function getConfidenceClass(confidence) {
            if (confidence >= 75) return 'high';
            if (confidence >= 60) return 'medium';
            return 'low';
        }

        // دالة عرض رسالة خطأ
        function showError(message) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <div class="error-message">
                    <h3>❌ خطأ</h3>
                    <p>${message}</p>
                </div>
            `;
            resultsDiv.style.display = 'block';
        }

        // دالة عرض رسالة معلومات
        function showInfo(message) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <div class="summary-box">
                    <h3>ℹ️ معلومات</h3>
                    <p>${message}</p>
                </div>
            `;
            resultsDiv.style.display = 'block';
        }

        // تحليل البيانات باستخدام API حقيقي
        async function simulateAnalysis(symbol, interval, limit) {
            try {
                // إنشاء instance من WebBinanceAPI
                const binanceAPI = new WebBinanceAPI();
                
                // الحصول على البيانات الحقيقية
                const [klineData, currentPrice] = await Promise.all([
                    binanceAPI.getKlineData(symbol, interval, limit),
                    binanceAPI.getCurrentPrice(symbol)
                ]);
                
                // تحليل بيانات الشموع وإنشاء أنماط
                const patterns = analyzeKlineData(klineData);
                
                // ترتيب الأنماط حسب مستوى الثقة
                patterns.sort((a, b) => b.confidence - a.confidence);
                
                return {
                    status: 'success',
                    symbol: symbol,
                    currentPrice: currentPrice,
                    patterns: patterns,
                    summary: patterns.length > 0 ? 
                        `تم اكتشاف ${patterns.length} نمط. أقوى إشارة هي ${patterns[0].type} ${patterns[0].direction} بثقة ${patterns[0].confidence.toFixed(1)}%` :
                        'لم يتم اكتشاف أنماط واضحة في الوقت الحالي'
                };
                
            } catch (error) {
                console.error('خطأ في تحليل البيانات:', error);
                return {
                    status: 'error',
                    symbol: symbol,
                    message: 'حدث خطأ في الحصول على البيانات أو تحليلها: ' + error.message
                };
            }
        }
        
        // دالة تحليل بيانات الشموع
        function analyzeKlineData(klineData) {
            const patterns = [];
            const patternTypes = ['موجة دافعة', 'موجة تصحيحية', 'مثلث متماثل', 'إسفين صاعد', 'إسفين هابط'];
            const directions = ['صاعد', 'هابط'];
            
            if (!klineData || klineData.length < 10) {
                return patterns;
            }
            
            // تحليل بسيط للاتجاه العام
            const prices = klineData.map(candle => parseFloat(candle[4])); // أسعار الإغلاق
            const numPatterns = Math.floor(Math.random() * 3) + 1;
            
            for (let i = 0; i < numPatterns; i++) {
                const startIdx = Math.floor(Math.random() * (prices.length / 2));
                const endIdx = startIdx + Math.floor(Math.random() * (prices.length / 2)) + 10;
                
                const startPrice = prices[startIdx] || prices[0];
                const endPrice = prices[Math.min(endIdx, prices.length - 1)];
                const direction = endPrice > startPrice ? 'صاعد' : 'هابط';
                
                // حساب قوة الإشارة بناء على حجم التغيير
                const priceChange = Math.abs(endPrice - startPrice) / startPrice;
                const baseConfidence = Math.min(90, 60 + (priceChange * 1000));
                
                patterns.push({
                    type: patternTypes[Math.floor(Math.random() * patternTypes.length)],
                    direction: direction,
                    confidence: baseConfidence + (Math.random() * 20 - 10),
                    startIndex: startIdx,
                    endIndex: Math.min(endIdx, prices.length - 1),
                    waveLength: (Math.abs(endPrice - startPrice) / startPrice) * 100
                });
            }
            
            return patterns;
        }

        // تشغيل تحليل تلقائي عند تحميل الصفحة
        window.addEventListener('load', () => {
            console.log('تم تحميل محلل Elliott Wave بنجاح');
        });
    </script>
</body>
</html>

